<!DOCTYPE html>
<html>
    <head>
        <%- include("partials/head.ejs") %>
        <link rel="stylesheet" href="/css/sessions.css" />
        <title>High Street Gym - Sessions</title>
    </head>
    <body>
        <main>
            <%- include("partials/header.ejs") %>
            <section class="sessions">
                <h2>Upcoming Sessions</h2>
                <form method="GET" action="/sessions">
                    <input
                        type="text"
                        name="search"
                        id="search"
                        class="full"
                        placeholder="Search by activity, trainer, location or date"
                        value="<%= searchTerm %>"
                    />
                    <% if (user?.role === "admin") { %>
                        <div class="toggle">
                            <input type="checkbox" name="all" id="allSessions" <%= allSessions ? 'checked' : '' %> onchange="this.form.submit()">
                            <label for="allSessions">All Sessions</label>
                        </div>
                    <% } %>
                    <select name="location" id="location" onchange="this.form.submit()">
                        <option value="all" <%= locationFilter === 'all' ? 'selected' : '' %>>All Locations</option>
                        <% locations.forEach(location => { %>
                                <option
                                    value="<%= location.name.toLowerCase() %>"
                                    <%= locationFilter === location.name.toLowerCase() ? 'selected' : '' %>
                                >
                                    <%= location.name %>
                                </option>
                        <% }); %>
                    </select>
                </form>

                <% if (sessions.length) { %>
                    <% sessions.forEach(session => { %>
                        <%- include('partials/session_card.ejs', {
                            session,
                            user,
                            mode: 'sessions',
                            formatActivityName,
                            formatDate,
                            timeUntil,
                            spotsLeft: session.activity.capacity - session.bookings.length
                        }) %>
                    <% }); %>
                <% } else { %>
                    <div class="no-sessions">
                        <p>No upcoming sessions available.</p>
                    </div>
                <% } %>
            </section>
            <%- include("partials/footer.ejs") %>
        </main>
    </body>
</html>

