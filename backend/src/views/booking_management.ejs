<!DOCTYPE html>
<html>
  <head>
    <%- include("partials/head.ejs") %>
    <link rel="stylesheet" href="/css/manage.css" />
    <title>High Street Gym - Manage Bookings</title>
  </head>
  <body>
    <main>
      <%- include("partials/header.ejs") %>
      <section class="manage">
        <h2>Manage Bookings</h2>

        <form
          action="<%= ROUTES.MANAGE_BOOKINGS.getPath(bookingDetail?.booking?.id) %>"
          method="post"
          class="card secondary"
        >
          <div class="field inline">
            <label for="member">Member</label>
            <div class="icon left">
              <img src="/img/person.svg" alt="Member icon" />
              <select name="member" id="member" class="full" required>
                <% users.filter(user => user.role === 'member').forEach(user => { %>
                  <option value="<%= user.id %>" <%= bookingDetail && bookingDetail.member && bookingDetail.member.id === user.id ? 'selected' : '' %>>
                    <%= `${user.firstName} ${user.lastName}`.trim() || user.username %>
                  </option>
                <% }) %>
              </select>
            </div>
          </div>

          <div class="field inline">
            <label for="session">Session</label>
            <div class="icon left">
              <img src="/img/run.svg" alt="Session icon" />
              <select name="session" id="session" class="full" required>
                <% sessions.forEach(sessionDetails => { %>
                  <option value="<%= sessionDetails.session.id %>" <%= bookingDetail && bookingDetail.session && bookingDetail.session.id === sessionDetails.session.id ? 'selected' : '' %>>
                    <%= formatSessionDetails(sessionDetails) %>
                  </option>
                <% }) %>
              </select>
            </div>
          </div>

          <% if (bookingDetail) { %>
            <div class="icon left">
              <img src="/img/delete.svg" alt="Delete icon" />
              <input
                formaction="<%= ROUTES.MANAGE_BOOKINGS_DELETE.getPath(bookingDetail.booking.id) %>"
                formmethod="post"
                class="button delete full"
                type="submit"
                value="Delete"
              >
            </div>
          <% } %>

          <div class="row gap-2">
            <a
              href="<%= bookingDetail ? ROUTES.MANAGE_BOOKINGS.getPath() : ROUTES.DASHBOARD.getPath() %>"
              class="button secondary full"
            >
              Cancel
            </a>
            <div class="icon right full">
              <img src="/img/save.svg" alt="Save icon" />
              <input
                type="submit"
                class="button full"
                value="<%= bookingDetail ? 'Save' : 'Create' %>"
              >
            </div>
          </div>
        </form>

        <h3>Bookings</h3>

        <form class="row items-center gap-2">
          <input
            type="text"
            name="search"
            id="search"
            placeholder="Search bookings by member, activity, trainer, location or date"
            class="full"
            value="<%= search %>"
            minlength="2"
            maxlength="100"
          />
        </form>

        <% if (bookingDetails.length) { %>
          <ul>
            <% bookingDetails.forEach(bookingDetail => { %>
              <%- include('partials/manage_list_item.ejs', {
                name: formatBookingDetails(bookingDetail),
                url: ROUTES.MANAGE_BOOKINGS.getPath(bookingDetail.booking.id)
              }) %>
            <% }) %>
          </ul>
        <% } else { %>
          <p>No bookings found.</p>
        <% } %>
      </section>
      <%- include("partials/footer.ejs") %>
    </main>
  </body>
</html>
